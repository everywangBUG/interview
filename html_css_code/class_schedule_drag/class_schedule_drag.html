<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>class_schedule_drag</title>
    <style>
        .container {
            background-color: #f5faf6;
            padding: 20px;
            margin: 0 auto;
        }

        .title {
            text-align: center;
        }

        .status_bar {
            text-align: center;
        }

        .main_container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .left_sidebar {
            flex: 0 0 300px;
            display: flex;
        }
        
        .subject_pool {
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            background-color: #ffffff;
            border-radius: 20px;
        }

        .subject_pool_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .subject_pool_content > div {
            margin-bottom: 20px;
            background-color: #f8f9fa;
            text-align: center;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            line-height: 40px;
        }

        #add_subject_btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            min-width: 80px;
            transition: background-color 0.2s;
            color: #ffffff;
            background-color: #027bff;
        }

        .right_content {
            background-color: #ffffff;
            padding: 20px;
            margin-left: 20px;
            border-radius: 20px;
        }

        #timetable {
            border-collapse: collapse;
        }

        #timetable th {
            border: 1px solid #a8d5ba;
            font-weight: 600;
            font-size: 14px;
            padding: 12px;
            color: #2c5530;
        }

        #timetable th.dragging {
            opacity: 0.5;
            transform: scale(0.9);
        }
        
        #timetable_body td {
            border: 1px solid #a8d5ba;
            font-weight: 600;
            font-size: 14px;
            padding: 12px;
            color: #2c5530;
        }

        .virtical_text {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .time_display {
            
        }

        .empty_cell {
            text-align: center;
            cursor: pointer;
            padding: 12px;
        }

        .cell {
            width: 120px;
            height: 80px;
        }

        .cell.drag_over {
            background-color: #e8f5c9;
            border: 2px dotted #4caf50 !important;
        }

    </style>
</head>

<body>
    <div class="container">
        <h2 class="title">拖曳生成课程表</h2>
        <div class="status_bar">
            <h3 id="status_message">拖曳科目到课程表中安排课程</和>
        </div>
        <div class="main_container">
            <div class="left_sidebar">
                <div class="subject_pool">
                    <div class="subject_pool_header">
                        <h3>科目池</h3>
                        <button id="add_subject_btn">+&nbsp;添加科目</button>
                    </div>
                    <div class="subject_pool_content">
                    </div>
                </div>
            </div>
            <div class="right_content">
                <table id="timetable">
                    <thead>
                        <tr>
                            <th>时间</th>
                            <th>课时</th>
                            <th>周一</th>
                            <th>周二</th>
                            <th>周三</th>
                            <th>周四</th>
                            <th>周五</th>
                            <th>周六</th>
                            <th>周日</th>
                        </tr>
                    </thead>
                    <tbody id="timetable_body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        const subjects = [
            { name: '语文', key: 'chinese', color: 'yellow' },
            { name: '数学', key: 'math', color: 'green'},
            { name: '英语', key: 'english', color: 'red' },
            { name: '美术', key: 'art', color: 'skyblue' },
            { name: '健康与体育', key: 'health', color: 'pink' },
            { name: '道德与法治', key: 'law', color: 'purple' },
            { name: '音乐', key: 'music', color: 'orange' }
        ]

        function initSubjectPool() {
            const subjectPoolContentEl = document.querySelector('.subject_pool_content');
            for (let i = 0; i < subjects.length; i++) {
                const div = document.createElement('div');
                div.textContent = subjects[i].name;
                div.setAttribute('draggable', true);
                div.setAttribute('data-subject', subjects[i].key);
                div.setAttribute('data-index', i);
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd)
                subjectPoolContentEl.append(div);
            }
        }
        
        initSubjectPool()

        function handleDragStart(e) {
            const subjectIndex = this.getAttribute('data-index');
            const subject = subjects[subjectIndex];
            e.dataTransfer.setData('subjectData', JSON.stringify({
                name: subject.name,
                color: subject.color,
                subject: subject.key,
                source: 'pool'
            }));

            // 设置拖曳效果
            e.dataTransfer.effectAllowed = 'move';

            // 添加拖曳的样式
            this.classList.add('dragging');

            updateStatusMessage('正在拖曳');
        }

        function handleDragEnd(e) {
            // 移除拖曳的样式
            document.querySelectorAll('.dragging').forEach(el => {
                el.classList.remove('dragging');
            })

            document.querySelectorAll('.drag_over').forEach(el => {
                el.classList.remove('drag_over');
            })

            updateStatusMessage('拖曳结束');
        }

        function initTimeTable() {
            const timetableEl = document.getElementById('timetable_body');

            const timeSlots = [
                { time: '08:00-08:40', label: '上午' },
                { time: '08:50-09:30' },
                { time: '10:00-10:40' },
                { time: '10:50-11:30' },
                { time: '14:00-14:40', label: '下午' },
                { time: '14:50-15:30' },
                { time: '15:40-16:20' }
            ]

            timeSlots.forEach((slot, index) => {
                const tr = document.createElement('tr');
                tr.className = 'period_tr';

                if (index === 0) {
                    const td = document.createElement('td');
                    td.className = 'time_cell';
                    td.setAttribute('rowspan', 4);
                    td.innerHTML = '<div class="virtical_text"><span>上</span><span>午</span></div>';
                    tr.append(td);
                } else if (index === 4) {
                    const td = document.createElement('td');
                    td.className = 'time_cell';
                    td.setAttribute('rowspan', 5);
                    td.innerHTML = '<div class="virtical_text"><span>下</span><span>午</span></div>';
                    tr.append(td);
                }

                const periodCell = document.createElement('td');
                periodCell.className = 'period_cell';
                periodCell.innerHTML = `<div class="time_display">${slot.time}</div>`;
                tr.append(periodCell);

                Array.from({length: 7}).forEach((_, index) => {
                    const td = document.createElement('td');
                    td.className = 'cell empty_cell';
                    td.setAttribute('data-day', index);
                    td.textContent = '+';

                    td.addEventListener('dragover', handleDragover);
                    td.addEventListener('dragleave', handleDragleave);
                    td.addEventListener('drop', handleDropLeave)

                    tr.append(td);
                });

                timetableEl.append(tr);
            })
        }

        initTimeTable();

        function handleDragover(e) {
            e.preventDefault();
            console.log('dragover')
            e.dataTransfer.dropEffect = 'move';
            this.classList.add('drag_over');
        }

        function handleDropLeave(e) {
            e.preventDefault();
        }

        function handleDragleave(e) {
            e.preventDefault();
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function updateStatusMessage(message) {
            const statusEl = document.getElementById('status_message');
            statusEl.textContent = message;
        }

    </script>
</body>

</html>